<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Menú</title>
  <style>
    :root{--bg:#f6f6f6;--card:#fff;--text:#111;--muted:#666;--line:#e9e9e9;--btn:#111;}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:var(--bg); color:var(--text);}
    .wrap{max-width:1100px; margin:0 auto; padding:26px 18px 60px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    h1{font-size:44px; margin:10px 0;}
    .actions{display:flex; gap:10px; flex-wrap:wrap;}
    button, .btn{
      border:1px solid var(--line); background:#fff; padding:10px 14px;
      border-radius:999px; cursor:pointer; font-weight:700;
    }
    .btnPrimary{background:var(--btn); color:#fff; border-color:var(--btn);}
    .card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px 18px; box-shadow:0 2px 10px rgba(0,0,0,.03);}
    .title{font-size:22px; font-weight:900; margin:0 0 12px;}
    .muted{color:var(--muted);}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media (max-width: 700px){.row{grid-template-columns:1fr;}}
    label{display:block; font-weight:800; margin:10px 0 6px;}
    input{
      width:100%; box-sizing:border-box; border:1px solid var(--line); border-radius:12px;
      padding:12px 12px; font-size:15px; background:#fff;
    }
    .right{display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;}
    .notice{padding:10px 12px; border-radius:12px; border:1px dashed var(--line); background:#fff; margin-top:12px;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Admin Menú</h1>
      <div class="actions">
        <a class="btn" href="./index.html">← Volver al menú</a>
        <button class="btn" id="btnLogout" style="display:none;">Cerrar sesión</button>
      </div>
    </header>

    <div class="card" id="loginCard">
      <p class="title">Iniciar sesión</p>
      <p class="muted">Solo usuarios autenticados pueden crear/editar/borrar menús y platos.</p>

      <div class="row">
        <div>
          <label>Email</label>
          <input id="loginEmail" type="email" placeholder="tu@email.com" />
        </div>
        <div>
          <label>Contraseña</label>
          <input id="loginPass" type="password" placeholder="••••••••" />
        </div>
      </div>

      <div class="right" style="margin-top:12px;">
        <button class="btn btnPrimary" id="btnLogin" type="button">Entrar</button>
      </div>

      <div class="notice">
        Si no tienes usuario, créalo en Supabase: <b>Authentication → Users → Add user</b> (email + password).
      </div>
    </div>

    <div class="card" id="app" style="display:none; margin-top:14px;">
      <p class="title">Sesión iniciada ✅</p>
      <p class="muted">Ahora sí está funcionando el login. Aquí va el panel completo (menús + platos).</p>
    </div>
  </div>

  <!-- Supabase CDN (sin módulos) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // ✅ CONFIG
    const SUPABASE_URL = "https://wljgbmgpjqvmaphrlwyh.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsamdibWdwanF2bWFwaHJsd3loIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMzA5NTAsImV4cCI6MjA4MTkwNjk1MH0.V4N_0vDA6ZYWfwNVoUH-QWuHMsElQENBDORs-aON8Cg";

    // window.supabase viene del CDN
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // UI refs
    const loginCard = document.getElementById("loginCard");
    const app = document.getElementById("app");
    const btnLogin = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");
    const loginEmail = document.getElementById("loginEmail");
    const loginPass = document.getElementById("loginPass");

    async function refreshUI() {
      const { data } = await supabaseClient.auth.getSession();
      const loggedIn = !!data.session;

      loginCard.style.display = loggedIn ? "none" : "block";
      app.style.display = loggedIn ? "block" : "none";
      btnLogout.style.display = loggedIn ? "inline-block" : "none";
    }

    btnLogin.addEventListener("click", async () => {
      try {
        const email = loginEmail.value.trim();
        const password = loginPass.value;

        if (!email || !password) {
          alert("Completa email y contraseña.");
          return;
        }

        const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });

        if (error) {
          alert("Login falló: " + error.message);
          console.error(error);
          return;
        }

        console.log("Login OK:", data);
        await refreshUI();
      } catch (e) {
        console.error(e);
        alert("Error inesperado, revisa consola (F12).");
      }
    });

    btnLogout.addEventListener("click", async () => {
      await supabaseClient.auth.signOut();
      await refreshUI();
    });

    refreshUI();
  </script>
</body>
</html>
