<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menú ADT</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial; margin:0; background:#f6f6f6;}
    header{padding:22px 18px; text-align:center; background:white; box-shadow:0 2px 14px rgba(0,0,0,.06);}
    h1{margin:0; font-size:42px;}
    .wrap{max-width:900px; margin:24px auto; padding:0 16px;}
    .topbar{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:14px;}
    .btn{background:#111; color:white; padding:10px 14px; border-radius:10px; text-decoration:none; font-weight:600;}
    .card{background:white; border-radius:14px; padding:18px; margin:12px 0; box-shadow:0 10px 30px rgba(0,0,0,.07);}
    .name{font-size:22px; font-weight:800; margin:0 0 6px;}
    .cat{opacity:.75; margin:0 0 6px;}
    .desc{margin:0; opacity:.9;}
    .muted{opacity:.7;}
  </style>
</head>
<body>
  <header>
    <h1>Menú</h1>
  </header>

  <div class="wrap">
    <div class="topbar">
      <div class="muted" id="status">Cargando menú...</div>
      <a class="btn" href="/admin.html">Admin</a>
    </div>

    <div id="list"></div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const SUPABASE_URL = "https://wljgbmgpjqvmaphrlwyh.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsamdibWdwanF2bWFwaHJsd3loIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMzA5NTAsImV4cCI6MjA4MTkwNjk1MH0.V4N_0vDA6ZYWfwNVoUH-QWuHMsElQENBDORs-aON8Cg";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("list");

    function card(item){
      const name = item.name ?? "Sin nombre";
      const category = item.category ?? "";
      const desc = item.description ?? "";
      return `
        <div class="card">
          <p class="name">${escapeHtml(name)}</p>
          ${category ? `<p class="cat">${escapeHtml(category)}</p>` : ""}
          ${desc ? `<p class="desc">${escapeHtml(desc)}</p>` : ""}
        </div>
      `;
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    async function cargarMenu(){
      statusEl.textContent = "Cargando menú...";
      const { data, error } = await supabase
        .from("menu_items")
        .select("id,name,category,description,date")
        .order("id", { ascending: true });

      if (error){
        statusEl.textContent = "Error cargando menú.";
        listEl.innerHTML = `<div class="card">Error: ${escapeHtml(error.message)}</div>`;
        return;
      }

      if (!data || data.length === 0){
        statusEl.textContent = "Menú vacío.";
        listEl.innerHTML = `<div class="card">No hay productos disponibles.</div>`;
        return;
      }

      statusEl.textContent = `${data.length} producto(s)`;
      listEl.innerHTML = data.map(card).join("");
    }

    // Carga inicial
    await cargarMenu();

    // "Auto-actualización": refresca cada 10s (simple y efectivo)
    setInterval(cargarMenu, 10000);
  </script>
</body>
</html>
